<!DOCTYPE html>
<html>
<head>
    <title>ุชูุธูุงุช ููพูฺฏ ูพูุฒ ุจุฑุฌ</title>
    <style>
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: right; }
        th { background-color: #f2f2f2; }
        input[type="text"] { width: 150px; padding: 5px; }
        .success { color: green; }
        .error { color: red; }
        .btn { padding: 8px 15px; margin: 5px; border: none; cursor: pointer; }
        .btn-test { background-color: #4CAF50; color: white; }
        .btn-save { background-color: #2196F3; color: white; padding: 10px 20px; }
    </style>
</head>
<body>
    <h2>๐บ๏ธ ูุฏุฑุช ููพูฺฏ ุดุนุจู ุจู ุณุฑูุณ ูุงุณุท</h2>

    <form method="post">
        {% csrf_token %}
        <table>
            <thead>
                <tr>
                    <th>ุดูุงุณู ุดุนุจู</th>
                    <th>ูุงู ุดุนุจู</th>
                    <th>IP ููุฏู ุดุนุจู</th>
                    <th>IP ุณุฑูุณ ูุงุณุท</th>
                    <th>ุชุณุช ุงุฑุชุจุงุท</th>
                </tr>
            </thead>
            <tbody>
                {% for item in current_mapping %}
                <tr>
                    <td>{{ item.branch.id }}</td>
                    <td>{{ item.branch.name }}</td>
                    <td>{{ item.branch.modem_ip|default:"ุชุนู ูุดุฏู" }}</td>
                    <td>
                        <input type="text"
                               name="branch_{{ item.branch.id }}"
                               value="{{ item.bridge_ip }}"
                               placeholder="192.168.1.100">
                    </td>
                    <td>
                        <button type="button" class="btn btn-test" onclick="testConnection({{ item.branch.id }})">
                            ุชุณุช ุงุฑุชุจุงุท
                        </button>
                        <br>
                        <span id="status_{{ item.branch.id }}"></span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit" class="btn btn-save">๐พ ุฐุฎุฑู ุชูุธูุงุช</button>
    </form>

    <div style="margin-top: 30px; padding: 15px; background-color: #f9f9f9;">
        <h3>๐ ุฑุงูููุง ุชูุธูุงุช:</h3>
        <ol>
            <li><strong>IP ุณุฑูุณ ูุงุณุท:</strong> ุขุฏุฑุณ ฺฉุงููพูุชุฑ ฺฉู ุณุฑูุณ ูพูุฒ ุจุฑุฌ ุฑู ุขู ุงุฌุฑุง ุดุฏู ุงุณุช</li>
            <li><strong>IP ููุฏู ุดุนุจู:</strong> ุขุฏุฑุณ ุฏุณุชฺฏุงู ูพูุฒ ููุงู ุดุนุจู (ุงุฒ ูุจู ุฏุฑ ุชูุธูุงุช ุดุนุจู ูุงุฑุฏ ุดุฏู)</li>
            <li>ุงุจุชุฏุง "ุชุณุช ุงุฑุชุจุงุท" ุฑุง ุจุฒูุฏุ ุณูพุณ ุชูุธูุงุช ุฑุง ุฐุฎุฑู ฺฉูุฏ</li>
            <li>ุจุฑุง ูุฑ ุดุนุจูุ IP ฺฉุงููพูุชุฑ ฺฉู ุณุฑูุณ ูุงุณุท ุฑู ุขู ุงุฌุฑุง ุดุฏู ุฑุง ูุงุฑุฏ ฺฉูุฏ</li>
        </ol>

        <h4>๐ ฺฺฏููู IP ฺฉุงููพูุชุฑ ุฑุง ูพุฏุง ฺฉููุ</h4>
        <p>ุฑู ฺฉุงููพูุชุฑ ฺฉู ุณุฑูุณ ูุงุณุท ุงุฌุฑุง ุดุฏูุ ูุฑูุฑฺฏุฑ ุฑุง ุจุงุฒ ฺฉูุฏ ู ุจู ุขุฏุฑุณ ุจุฑูุฏ: <code>http://localhost:5000/health</code></p>
        <p>ุฏุฑ ูพุงุณุฎุ ููุฏ <code>local_ip</code> ุฑุง ุจุจูุฏ</p>
    </div>

    <script>
    function testConnection(branchId) {
        const statusSpan = document.getElementById(`status_${branchId}`);
        statusSpan.innerHTML = 'โณ ุฏุฑ ุญุงู ุชุณุช ุงุฑุชุจุงุท...';
        statusSpan.className = '';

        fetch('/invoice/quick-pos-test-api/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({branch_id: branchId})
        })
        .then(response => response.json())
        .then(data => {
            if(data.status === 'success') {
                statusSpan.innerHTML = 'โ ุณุฑูุณ ูุนุงู - ' + data.bridge_ip;
                statusSpan.className = 'success';
            } else {
                statusSpan.innerHTML = 'โ ' + data.message;
                statusSpan.className = 'error';
            }
        })
        .catch(error => {
            statusSpan.innerHTML = 'โ ุฎุทุง ุฏุฑ ุชุณุช ุงุฑุชุจุงุท';
            statusSpan.className = 'error';
        });
    }
    </script>
</body>
</html>