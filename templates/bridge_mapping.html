<!DOCTYPE html>
<html>
<head>
    <title>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…Ù¾ÛŒÙ†Ú¯ Ù¾ÙˆØ² Ø¨Ø±ÛŒØ¬</title>
    <style>
        table { width: 100%; border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: right; }
        th { background-color: #f2f2f2; }
        input[type="text"] { width: 150px; padding: 5px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h2>ğŸ—ºï¸ Ù…Ø¯ÛŒØ±ÛŒØª Ù…Ù¾ÛŒÙ†Ú¯ Ø´Ø¹Ø¨Ù‡ Ø¨Ù‡ Ø³Ø±ÙˆÛŒØ³ ÙˆØ§Ø³Ø·</h2>

    <form method="post">
        {% csrf_token %}
        <table>
            <thead>
                <tr>
                    <th>Ø´Ù†Ø§Ø³Ù‡ Ø´Ø¹Ø¨Ù‡</th>
                    <th>Ù†Ø§Ù… Ø´Ø¹Ø¨Ù‡</th>
                    <th>IP Ù…ÙˆØ¯Ù… Ø´Ø¹Ø¨Ù‡</th>
                    <th>IP Ø³Ø±ÙˆÛŒØ³ ÙˆØ§Ø³Ø·</th>
                    <th>ØªØ³Øª Ø§Ø±ØªØ¨Ø§Ø·</th>
                </tr>
            </thead>
            <tbody>
                {% for item in current_mapping %}
                <tr>
                    <td>{{ item.branch.id }}</td>
                    <td>{{ item.branch.name }}</td>
                    <td>{{ item.branch.modem_ip|default:"ØªØ¹ÛŒÛŒÙ† Ù†Ø´Ø¯Ù‡" }}</td>
                    <td>
                        <input type="text"
                               name="branch_{{ item.branch.id }}"
                               value="{{ item.bridge_ip }}"
                               placeholder="192.168.1.100">
                    </td>
                    <td>
                        <button type="button" onclick="testConnection({{ item.branch.id }})">
                            ØªØ³Øª Ø§Ø±ØªØ¨Ø§Ø·
                        </button>
                        <br>
                        <span id="status_{{ item.branch.id }}"></span>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <button type="submit">ğŸ’¾ Ø°Ø®ÛŒØ±Ù‡ ØªÙ†Ø¸ÛŒÙ…Ø§Øª</button>
    </form>

    <script>
    function testConnection(branchId) {
        const statusSpan = document.getElementById(`status_${branchId}`);
        statusSpan.innerHTML = 'â³ Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª...';

        fetch('/invoice/test-bridge-connection/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': '{{ csrf_token }}'
            },
            body: JSON.stringify({branch_id: branchId})
        })
        .then(response => response.json())
        .then(data => {
            if(data.status === 'success') {
                statusSpan.innerHTML = 'âœ… Ø³Ø±ÙˆÛŒØ³ ÙØ¹Ø§Ù„';
                statusSpan.style.color = 'green';
            } else {
                statusSpan.innerHTML = 'âŒ ' + data.message;
                statusSpan.style.color = 'red';
            }
        });
    }
    </script>
</body>
</html>